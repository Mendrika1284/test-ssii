// Generated by CoffeeScript 2.5.1
(function() {
  var Decimal, http, jsonParser, request, server, test;

  test = require('ava');

  request = require('superagent');

  http = require('http');

  Decimal = require('decimal.js-light');

  jsonParser = require('..');

  server = null;

  test.before(function() {
    server = http.createServer(function(req, res) {
      res.statusCode = 200;
      res.setHeader('Content-Type', 'application/json');
      return res.end('{"value":59}');
    });
    server.listen(3000, '127.0.0.1');
  });

  test.after(function() {
    server.close();
  });

  test('it should parse numbers properly', async function(t) {
    var body;
    ({body} = (await request.get('http://127.0.0.1:3000/').accept('json').use(jsonParser())));
    t.is(body.value, 59);
  });

  test('it should parse numbers as string', async function(t) {
    var body;
    ({body} = (await request.get('http://127.0.0.1:3000/').accept('json').use(jsonParser(function(text) {
      return text;
    }))));
    t.is(body.value, '59');
  });

  test('it should parse numbers as exact decimal', async function(t) {
    var body;
    ({body} = (await request.get('http://127.0.0.1:3000/').accept('json').use(jsonParser(function(text) {
      return new Decimal(text);
    }))));
    t.true(body.value.equals(new Decimal(59)));
  });

}).call(this);
